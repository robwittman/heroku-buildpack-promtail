#!/usr/bin/env bash

set -e
set -o pipefail 

## Install promtail 

# Ensure version
if [[ -z "$PROMTAIL_VERSION" ]]; then 
  PROMTAIL_VERSION="v1.6.1"
fi

# Ensure endpoint 
if [[ -z "$PROMTAIL_ENDPOINT" ]]; then 
  PROMTAIL_ENDPOINT="some-super-cool-host.com"
fi
echo "------> Installing Promtail version ${PROMTAIL_VERSION}"
curl -fSL -o promtail.gz "https://github.com/grafana/loki/releases/download/${PROMTAIL_VERSION}/promtail-linux-amd64.zip"
gunzip promtail.gz
chmod a+x /usr/local/bin/promtail 
mv promtail /usr/local/bin/

# Generate promtail config, or use existing 
if [[ -z "$PROMTAIL_CONFIG" ]]; then 
  
else 
    

fi

# Install the service 
mkdir -p "$BUILD_DIR/.profile.d"
chmod +x "$BUILD_DIR/.profile.d/promtail.sh"

